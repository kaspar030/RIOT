module:
  - name: relic
    license: LGPL-2.1
    download:
      git:
        url: https://github.com/relic-toolkit/relic.git
        commit: e3f82e36250b228f3b4646781f6e06a8be497d18
      patches:
        - patches/0001-use-modul-random-for-seeding.patch
        - patches/0002-add-RIOT-random-support-to-cmake-and-relic_conf.h.patch
    depends:
      - random
    build:
      cmd:
        - rm -rf ${bindir}/*
        - mkdir -p ${bindir}
        - export CC='${CC}'
        - export CXX='${CXX}'
        - export LINK='${LINK}'
        - export CFLAGS='${CFLAGS} ${CFLAGS_ARCH} ${CFLAGS_CODEGEN} ${CFLAGS_DEFINES}'
        - ${root}/dist/tools/cmake/generate-xcompile-toolchain.sh > ${TOOLCHAIN_FILE}
        - cmake
          -DCMAKE_TOOLCHAIN_FILE=$$(realpath ${TOOLCHAIN_FILE})
          -DCHECK=off -DTESTS=0 -DBENCH=0 -DSHLIB=off -Wno-dev
          ${RELIC_CONFIG_FLAGS}
          -S ${srcdir} -B ${bindir} -G Ninja
        - ninja -C ${bindir}
      out:
        - ${bindir}/lib/librelic_s.a
    env:
      local:
        srcdir: ${srcdir}
        TOOLCHAIN_FILE: ${bindir}/xcompile-toolchain.cmake
        CFLAGS:
          - -Wno-unused-function
          - -Wno-missing-include-dirs
          - -Wno-error
          - -Wno-error=old-style-definition
          - -Wno-error=strict-prototypes
          - -Wno-array-parameter
          - -Wno-stringop-overflow
          - -Wno-unused-but-set-variable
          - -std=gnu99
      export:
        LINKFLAGS:
          - --whole-archive
        includes:
          - ${bindir}/include
          - ${srcdir}/include
      global:
        libs:
          - ${bindir}/lib/librelic_s.a
