module:
  - name: relic
    license: LGPL-2.1
    download:
      git:
        url: https://github.com/relic-toolkit/relic.git
        commit: 0b0442a8218df8d309266923f2dd5b9ae3b318ce
    build:
      cmd:
        - rm -rf ${bindir}/*
        - mkdir -p ${bindir}
        - export CC='${CC}'
        - export CXX='${CXX}'
        - export LINK='${LINK}'
        - dist/tools/cmake/generate-xcompile-toolchain.sh > ${TOOLCHAIN_FILE}
        - COMP='${CFLAGS} ${CFLAGS_ARCH} ${CFLAGS_CODEGEN}' cmake
          -DCMAKE_TOOLCHAIN_FILE=$$(realpath ${TOOLCHAIN_FILE})
          -DCHECK=off -DTESTS=0 -DBENCH=0 -DSHLIB=off -Wno-dev
          ${RELIC_CONFIG_FLAGS}
          -S ${srcdir} -B ${bindir} -G Ninja
        - ninja -C ${bindir}
      out: lib/librelic_s.a
      build_before_dependees: true
    env:
      local:
        srcdir: ${srcdir}
        TOOLCHAIN_FILE: ${bindir}/xcompile-toolchain.cmake
        CFLAGS:
          - -Wno-unused-function
          - -Wno-missing-include-dirs
          - -Wno-error
          - -Wno-error=old-style-definition
          - -Wno-error=strict-prototypes
          - -std=gnu99
      export:
        LINKFLAGS:
          - --whole-archive
        includes:
          - ${bindir}/include
          - ${srcdir}/include
