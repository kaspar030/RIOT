modules:
  - name: ztimer
    depends:
      - ?auto_init_ztimer
      - ztimer_core

  - name: ztimer_core
    uses:
      - pm_layered
      - ztimer_extend
      - ztimer_now64
      - ztimer_ondemand
      - ztimer_ondemand_strict
    sources:
      - core.c
      - util.c
      - periodic.c

---
defaults:
  module:
    depends:
      - ztimer
      - ztimer_extend

modules:
  - name: auto_init_ztimer
    depends:
      - ?auto_init
      - ?ztimer_auto_init

  - name: ztimer_now64
  - name: ztimer_extend
  - name: ztimer_ondemand

  - name: ztimer_usec
  - name: ztimer_msec
    depends:
      - ztimer_msec_backend
  - name: ztimer_sec

  - name: ztimer_auto_init
    depends:
      - ztimer_convert_frac
      - ztimer_convert_shift
      - ztimer_periph_timer
    uses:
      - auto_init_ztimer
      - pm_layered
      - ztimer_auto_adjust
      - ztimer_msec
      - ztimer_periph_rtc
      - ztimer_periph_rtt
      - ztimer_periph_timer
      - ztimer_sec
      - ztimer_usec

    sources:
      - init.c

  - name: ztimer_auto_adjust

  - name: ztimer_convert
    sources:
      - convert.c

  - name: ztimer_convert_frac
    depends:
      - ztimer_convert
      - frac
    sources:
      - convert_frac.c

  - name: ztimer_convert_muldiv64
    depends:
      - ztimer_convert
    sources:
      - convert_muldiv64.c

  - name: ztimer_convert_shift
    depends:
      - ztimer_convert
    sources:
      - convert_shift.c

  - name: ztimer_mock
    uses:
      - ztimer_ondemand
    sources:
      - mock.c

  - name: ztimer_overhead
    sources:
      - overhead.c

  - name: ztimer_periph_rtt
    provides:
      - ztimer_msec_backend
    depends:
      - periph_rtt
    uses:
      - ztimer_ondemand_rtt
    sources:
      - periph_rtt.c

  - name: ztimer_periph_timer
    provides:
      - ztimer_msec_backend
    depends:
      - periph_timer
    uses:
      - ztimer_ondemand_timer
    sources:
      - periph_timer.c


  - name: ztimer_periph_rtc
    depends:
      - periph_rtc
    uses:
      - ztimer_ondemand_rtc
    sources:
      - periph_rtc.c

  - name: ztimer_periph_ptp
    depends:
      - periph_ptp
    sources:
      - periph_ptp.c
---
defaults:
  module:
    selects:
      - ztimer_ondemand
modules:
  - name: ztimer_ondemand_rtt
  - name: ztimer_ondemand_rtc
  - name: ztimer_ondemand_strict
  - name: ztimer_ondemand_timer
