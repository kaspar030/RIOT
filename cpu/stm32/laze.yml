context:
  - name: stm32
    parent: cortexm
    env:
      CFLAGS:
        - -I${relpath}/include
        - -I${relpath}/include/clk
      LINKFLAGS:
        - -L${relpath}/ldscripts

  - name: stm32f4
    parent: stm32
    env:
      stm32_cpu_line: f4
      CFLAGS:
        - -mcpu=cortex-m4
        - -mfloat-abi=soft
        - -DRIOT_MCU=\"stm32f4\"
        - -DCPU_STM32F4
        - -DCPU_FAM_STM32F4
        - -DCPU_CORE_CORTEX_M4F
        - -I${relpath}/include
      LINKFLAGS:
        - -Tstm32.ld
        - -Wl,--defsym=_rom_start_addr=0x08000000
        - -Wl,--defsym=_ram_start_addr=0x20000000
      ARM_MATH: -DARM_MATH_CM4
    disable:
      - periph_flashpage
      - periph_hwrng
      - periph_rtc
      - periph_rtt

  - name: stm32f411re
    parent: stm32f4
    env:
      CFLAGS:
        - -DCPU_MODEL_STM32F411RE
        - -DCPU_LINE_STM32F411xE
        - -DSTM32F411xE
      ROM_LEN: "512K"
      RAM_LEN: "128K"
      FLASHSIZE: "524288"

  - name: stm32f401re
    parent: stm32f4
    env:
      CFLAGS:
        - -DCPU_MODEL_STM32F401RE
        - -DCPU_LINE_STM32F401xE
        - -DSTM32F401xE
      ROM_LEN: "512K"
      RAM_LEN: "96K"
      FLASHSIZE: "524288"

  - name: stm32f407vg
    parent: stm32f4
    env:
      CFLAGS:
        - -DCPU_MODEL_STM32F407VG
        - -DCPU_LINE_STM32F407xx
        - -DSTM32F407xx
      ROM_LEN: "1024K"
      RAM_LEN: "192K"
      FLASHSIZE: "1048576"

module:
  - name: stm32
    context: stm32
    sources:
      - cpu_common.c
      - cpu_init.c
    depends:
      - cortexm
      - pm_layered
      - stm32_cmsis
      - stm32_vectors
      - stm32_irqs
      - stm32_clk

  - name: stm32f4
    context: stm32f4
    depends:
      - stm32
      - periph_common

  - name: stm32_irqs
    context: stm32
    depends:
      - stm32_cmsis
    build:
      cmd:
        - ${relpath}/dist/irqs/gen_irqs.py
            ${stm32_cpu_line}
            ${stm32_cmsis_srcdir}/Include
            ${stm32_irqs_dir}/irqs/${stm32_cpu_line}/irqs.h
      out:
        - ${stm32_irqs_dir}/irqs/${stm32_cpu_line}/irqs.h
    env:
      export:
        stm32_irqs_dir: ${build-dir}/generated/stm32
        includes:
          - ${stm32_irqs_dir}

subdirs:
  - periph
  - include/vendor
  - stmclk
  - vectors
