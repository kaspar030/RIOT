context:
  - name: atmega_common
    parent: riot
    disable:
      # causes internal compiler error on gcc 11.2.0
      - lto
    env:
      PREFIX: avr-
      LINKFLAGS:
        - -Wl,--defsym=__TEXT_REGION_LENGTH__=${ROM_LEN}-${RAM_LEN}
        - -Wl,--defsym=__DATA_REGION_LENGTH__=${RAM_LEN}
        - -e reset_handler

defaults:
  module:
    context:
      atmega_common

module:
  - name: atmega_common
    depends:
      - avr_libc_extra
      - core
    sources:
      - cpu.c
      - irq_arch.c
      - startup.c
      - thread_arch.c
    env:
      export:
        includes:
        - ${relpath}/include

  - name: feature/periph_cpuid
  - name: feature/periph_eeprom
  - name: feature/periph_pm

subdirs:
  - periph
