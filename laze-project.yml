rule:
    - name: CC
      in: '.c'
      out: '.o'
      depfile: "$out.d"
      deps: gcc
      cmd: 'ccache ${CC} -MMD -MF $out.d ${CFLAGS_STD} ${CFLAGS} ${testsuites} -c ${in} -o ${out}'
    - name: CXX
      in: '.cpp'
      out: '.o'
      depfile: "$out.d"
      deps: gcc
      cmd: 'ccache ${CXX} -MMD -MF $out.d ${CXXFLAGS_STD} ${CFLAGS} ${CXXFLAGS} ${testsuites} -c ${in} -o ${out}'
    - name: ASM
      in: '.S'
      out: '.o'
      cmd: '${CC} ${CFLAGS} -c ${in} -o ${out}'
    - name: LINK
      in: '.o'
      options:
          combine: true
      cmd: '${LINK} ${LINKFLAGS} ${CFLAGS} ${in} ${libs} -o ${out}'

    - name: SYMLINK
      cmd: 'ln -f ${in} ${out}'

context:
    - name: default
      bindir: "build/bin/${builder}"
      vars:
          CFLAGS:
            - -Wall
            - -Werror
            #- -Wold-style-definition
            #- -Wstrict-prototypes
            - -Os
            - -g

    - name: riot
      parent: default
      vars:
          CFLAGS:
            - -I${relpath}/drivers/include
            - -I${relpath}/sys/include
            - -DRIOT_VERSION=\"laze\"
          CXXFLAGS_STD:
            - -std=c++11
      var_options:
          testsuites:
              start: -DTEST_SUITES=
              joiner: ','
      tools:
          size:
              cmd:
               - "${SIZE} ${out}"

builder:
          - name: host
            parent: default
            vars:
                CC  : gcc
                CXX : g++
                LINK: gcc
                SIZE: size
            tools:
                run:
                    cmd:
                     - "${out}"

module:
    - name: riot
      context: riot

    - name: riot_info
      context: riot
      export_vars:
          CFLAGS:
            - -DFOO=\"${builder}\"
            - -DRIOT_BOARD=\"${builder}\"

    - name: host
      context: host

    - name: cpp
      depends:
        - feature/cpp

subdirs:
    [ dist, core, boards, cpu, drivers, sys, examples, tests, pkg ]
